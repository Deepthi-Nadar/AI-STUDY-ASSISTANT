<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quixxx</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
/* Reset */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* Background + Global Font */
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  background: radial-gradient(circle at 30% 30%, #0d0017, #1a0036);
  color: #e7e7e7;
  min-height: 100vh;
  display: flex;
}

/* Sidebar */
.sidebar {
  width: 250px;
  background: rgba(20, 0, 40, 0.7);
  backdrop-filter: blur(8px);
  border-right: 1px solid rgba(255, 255, 255, 0.08);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 20px;
}

.sidebar h2 {
  font-size: 24px;
  font-weight: 700;
  background: linear-gradient(90deg, #ff4ecd, #a200ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 20px;
}

.quiz-history h3 {
  color: #aaa;
  font-size: 14px;
  margin-bottom: 10px;
}

.quiz-history p {
  margin: 6px 0;
  cursor: pointer;
  font-size: 14px;
  color: #ccc;
  transition: color 0.3s;
}

.quiz-history p:hover {
  color: #fff;
}

/* Back Button */
.back-btn {
  background: #333;
  border: none;
  padding: 8px;
  border-radius: 8px;
  cursor: pointer;
  text-align: center;
  color: #fff;
  text-decoration: none;
  font-size: 14px;
  transition: background 0.3s;
}

.back-btn:hover {
  background: #444;
}

/* Main Content */
.main {
  flex-grow: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 40px;
  overflow-y: auto;
}

/* Input Box */
.input-box {
  display: flex;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 12px;
  width: 400px;
  background: rgba(255, 255, 255, 0.05);
  margin-bottom: 20px;
}

.input-box input {
  border: none;
  outline: none;
  flex-grow: 1;
  font-size: 16px;
  background: transparent;
  color: #fff;
}

/* Difficulty Buttons */
.difficulty {
  margin: 20px 0;
  display: flex;
  gap: 10px;
}

.difficulty button {
  padding: 8px 16px;
  border-radius: 25px;
  border: none;
  cursor: pointer;
  font-size: 14px;
  background: #2a2a2a;
  color: #ddd;
  transition: all 0.3s;
}

.difficulty button.active {
  background: linear-gradient(90deg, #a200ff, #ff4ecd);
  color: #fff;
  box-shadow: 0 0 10px rgba(162, 0, 255, 0.6);
}

.difficulty button:hover {
  background: #444;
}

/* Generate Button */
.btn.generate-btn {
  background: linear-gradient(90deg, #a200ff, #ff4ecd);
  color: white;
  padding: 12px 22px;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  font-weight: 600;
  font-size: 15px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(162, 0, 255, 0.4);
}

.btn.generate-btn:hover {
  transform: scale(1.05);
  background: linear-gradient(90deg, #ff4ecd, #a200ff);
}

/* Quiz Card */
.quiz-card {
  width: 600px;
  padding: 25px;
  border-radius: 16px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
  margin-top: 20px;
}

/* Progress Bar */
.progress {
  height: 6px;
  background: #333;
  border-radius: 5px;
  margin-bottom: 15px;
}

.progress-bar {
  height: 6px;
  background: linear-gradient(90deg, #9b5de5, #f15bb5);
  width: 0%;
  border-radius: 5px;
}

/* Question */
.question {
  font-size: 18px;
  margin-bottom: 15px;
  font-weight: 600;
  color: #fff;
}

/* Options */
.options button {
  display: block;
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border: none;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.08);
  cursor: pointer;
  font-size: 15px;
  text-align: left;
  color: #ddd;
  transition: background 0.3s;
}

.options button:hover {
  background: rgba(255, 255, 255, 0.15);
}

.options button.correct {
  background: #4caf50;
  color: white;
}

.options button.wrong {
  background: #e74c3c;
  color: white;
}

/* Controls */
.controls button {
  background: #333;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 6px 12px;
  cursor: pointer;
  transition: background 0.3s;
}

.controls button:hover {
  background: #555;
}

/* Submit */
.submit-btn {
  background: linear-gradient(90deg, #a200ff, #ff4ecd);
  border: none;
  padding: 12px 20px;
  border-radius: 25px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  margin-top: 15px;
  color: white;
  transition: transform 0.3s;
}

.submit-btn:hover {
  transform: scale(1.05);
}

/* Analytics */
.analytics {
  width: 80%;
  margin-top: 20px;
  display: none;
}

.analytics h2 {
  font-size: 22px;
  background: linear-gradient(90deg, #ff4ecd, #a200ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.stats {
  display: flex;
  gap: 20px;
  margin: 20px 0;
}

.stat-box {
  flex: 1;
  background: rgba(255, 255, 255, 0.08);
  padding: 15px;
  border-radius: 12px;
  text-align: center;
  color: #ddd;
}

/* User Status */
.user-status {
  margin-bottom: 15px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.15);
}

/* Correct/Incorrect Count Colors */
#correctCount {
  color: #4caf50; /* green */
  font-weight: bold;
}

#incorrectCount {
  color: #e74c3c; /* red */
  font-weight: bold;
}


.logout-btn {
  padding: 6px 12px;
  background: #ff4757;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
  width: 100%;
}

.logout-btn:hover {
  background: #ff3742;
}



#userEmail {
  font-size: 12px;  /* make it smaller */
  color: #bbb;      /* optional: make it a bit lighter */
}



  </style>
</head>

<body>
  <div class="sidebar">
    <div>
      <h2>quixxx</h2>

      <!-- User status section -->
      <div id="userStatus" class="user-status" style="display: none;">
        <p>Logged in as: <span id="userEmail"></span></p>
        <button onclick="logout()" class="logout-btn">Logout</button>
      </div>



      <div class="quiz-history">
        <h3>Recent Quizzes</h3>
        <div id="historyList"></div>
      </div>
    </div>

    <a href="/features" class="back-btn">⬅ Back</a>
  </div>

  <div class="main">
    <!-- Start screen -->
    <div id="start-screen">
      <h1>What topic would you like to be quizzed on?</h1>
      <div class="input-box">
        <input type="text" id="topicInput" placeholder="Enter the topic">
      </div>
      <div class="difficulty">
        <button>Easy</button>
        <button>Medium</button>
        <button>Hard</button>
      </div>
      <button class="btn generate-btn" id="generateBtn">Generate Quiz</button>
    </div>

    <!-- Quiz screen -->
    <div id="quiz-screen" style="display:none;">
      <div class="quiz-card">
        <div class="progress">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="question" id="questionText"></div>
        <div class="options" id="optionsContainer"></div>
        <div class="controls">
          <button onclick="prevQuestion()">⬅</button>
          <span id="qCount"></span>
          <button onclick="nextQuestion()">➡</button>
        </div>
        <button class="submit-btn" onclick="submitQuiz()">Submit Quiz</button>
      </div>
    </div>

    <!-- Analytics -->
    <div class="analytics" id="analytics">
      <h2>Analytics</h2>
      <div class="stats">ZZ
        <div class="stat-box">Total Time Taken: <span id="totalTime"></span> seconds</div>
        <div class="stat-box">Average Time / Question: <span id="avgTime"></span> sec</div>
      </div>
      <canvas id="timeChart"></canvas>
      <div class="stats">
        <div class="stat-box">Correct Answers: <span id="correctCount"></span></div>
        <div class="stat-box">Incorrect Answers: <span id="incorrectCount"></span></div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // -------------------- Firebase Config --------------------
    const firebaseConfig = {
      apiKey: "AIzaSyAr7SmLpvYM_N_-4N61C0Vf5Wxh5QZysHE",
      authDomain: "ai-study-assistant-4a267.firebaseapp.com",
      projectId: "ai-study-assistant-4a267",
      storageBucket: "ai-study-assistant-4a267.appspot.com",
      messagingSenderId: "536167254275",
      appId: "1:536167254275:web:4be2d353ab4c7c9f2e4136"
    };
    firebase.initializeApp(firebaseConfig);

    // -------------------- Variables --------------------
    let quizData = [];
    let currentQuestion = 0;
    let answers = [];
    let times = [];
    let startTime;
    let difficulty = "easy";

    // -------------------- Authentication Check --------------------
    firebase.auth().onAuthStateChanged((user) => {
      const userStatus = document.getElementById("userStatus");
      const userEmail = document.getElementById("userEmail");
      const generateBtn = document.getElementById("generateBtn");

      if (user) {
        // User is signed in
        userStatus.style.display = "block";
        userEmail.textContent = user.email;
        generateBtn.onclick = startQuiz;
         loadHistory();
        console.log("User is logged in:", user.uid);
      } else {
        // User is signed out
        userStatus.style.display = "none";
        alert("Please log in to use the quiz feature.");
        window.location.href = "index.html?login=true";
      }
    });

    // -------------------- Logout Function --------------------
    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = "index.html";
      }).catch((error) => {
        console.error("Logout error:", error);
      });
    }

    // -------------------- Difficulty Buttons --------------------
    document.querySelectorAll(".difficulty button").forEach(btn => {
      btn.addEventListener("click", () => {
        difficulty = btn.innerText.toLowerCase();
        document.querySelectorAll(".difficulty button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });

    // -------------------- Start Quiz --------------------
    async function startQuiz() {
      const user = firebase.auth().currentUser;
      if (!user) {
        alert("Please log in first.");
        window.location.href = "index.html?login=true";
        return;
      }

      const topic = document.getElementById("topicInput").value.trim();
      if (!topic) return alert("Please enter a topic.");

      const token = await user.getIdToken();

      document.getElementById("start-screen").style.display = "none";
      document.getElementById("quiz-screen").style.display = "block";

      try {
        const res = await fetch("/generate_quiz", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          },
          body: JSON.stringify({
            topic,
            difficulty,
            quiz_type: "mcq"
          })
        });

        const data = await res.json();
        if (!res.ok) {
          document.getElementById("start-screen").style.display = "block";
          document.getElementById("quiz-screen").style.display = "none";
          return alert(data.error || "Failed to generate quiz.");
        }

        quizData = data.quiz;
        if (!quizData || !quizData.length) {
          document.getElementById("start-screen").style.display = "block";
          document.getElementById("quiz-screen").style.display = "none";
          return alert("No quiz questions returned from AI.");
        }

        currentQuestion = 0;
        answers = [];
        times = [];
        startTime = Date.now();

        loadQuestion();
      } catch (err) {
        console.error(err);
        document.getElementById("start-screen").style.display = "block";
        document.getElementById("quiz-screen").style.display = "none";
        alert("Error generating quiz. Please try again.");
      }
    }

    // -------------------- Load Question --------------------
    function loadQuestion() {
      const q = quizData[currentQuestion];
      document.getElementById("questionText").innerText = q.question;

      const optionsContainer = document.getElementById("optionsContainer");
      optionsContainer.innerHTML = "";

      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.innerText = opt;
        btn.onclick = () => selectOption(i, btn);
        optionsContainer.appendChild(btn);
      });

      document.getElementById("qCount").innerText = `${currentQuestion + 1}/${quizData.length}`;
      updateProgress();
    }
    async function loadHistory() {
  const user = firebase.auth().currentUser;
  if (!user) return;

  const token = await user.getIdToken();
  const res = await fetch("/quiz_history", {
    headers: { "Authorization": `Bearer ${token}` }
  });

  if (!res.ok) {
    console.error("Failed to load quiz history");
    return;
  }

  const data = await res.json();
  const historyList = document.querySelector(".quiz-history");
  historyList.innerHTML = "<h3>Recent Quizzes</h3>";

  if (data.length === 0) {
    historyList.innerHTML += "<p>No recent quizzes</p>";
    return;
  }

  data.forEach(item => {
    const p = document.createElement("p");
    p.textContent = `${item.topic} (${item.difficulty})`;
    p.onclick = () => {
      document.getElementById("topicInput").value = item.topic;
      difficulty = item.difficulty;
      startQuiz();
    };
    historyList.appendChild(p);
  });
}

    // -------------------- Select Option --------------------
    function selectOption(index, btn) {
      const q = quizData[currentQuestion];
      const buttons = document.querySelectorAll("#optionsContainer button");
      buttons.forEach(b => b.disabled = true);

      if (index === q.answer) {
        btn.classList.add("correct");
        answers.push(true);
      } else {
        btn.classList.add("wrong");
        buttons[q.answer].classList.add("correct");
        answers.push(false);
      }

      const timeTaken = Math.floor((Date.now() - startTime) / 1000) - times.reduce((a, b) => a + b, 0);
      times.push(timeTaken);
    }

    // -------------------- Navigation --------------------
    function prevQuestion() {
      if (currentQuestion > 0) {
        currentQuestion--;
        loadQuestion();
      }
    }

    function nextQuestion() {
      if (currentQuestion < quizData.length - 1) {
        currentQuestion++;
        loadQuestion();
      }
    }

    function updateProgress() {
      const percent = ((currentQuestion + 1) / quizData.length) * 100;
      document.getElementById("progressBar").style.width = percent + "%";
    }

    // -------------------- Submit Quiz --------------------
    function submitQuiz() {
      document.getElementById("quiz-screen").style.display = "none";
      document.getElementById("analytics").style.display = "block";

      const total = times.reduce((a, b) => a + b, 0);
      document.getElementById("totalTime").innerText = total;
      document.getElementById("avgTime").innerText = (total / quizData.length).toFixed(1);
      document.getElementById("correctCount").innerText = answers.filter(a => a).length;
      document.getElementById("incorrectCount").innerText = answers.filter(a => !a).length;

      new Chart(document.getElementById("timeChart"), {
        type: 'line',
        data: {
          labels: quizData.map((_, i) => `Q${i + 1}`),
          datasets: [{
            label: 'Time Spent (sec)',
            data: times,
            borderColor: '#7d3cff',
            fill: false,
            tension: 0.3
          }]
        }
      });
    }
  </script>
</body>

</html>